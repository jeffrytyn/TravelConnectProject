<%- include('../partials/header') %>

<div class='container form-flex-div'>
    <form class='w-100' action='/accounts/<%= currentUser.username %>/posts/new' enctype="multipart/form-data" method="POST">
        <p class='display-4 text-center mt-5'>Make a New Post</p>
        <div class="form-group">
          <label for="postTitleInput">Title</label>
          <input type="text" class="form-control" id="postTitleInput" name='title' required>
        </div>
        <label for="postImgDiv">Image Upload</label>
        <div class="custom-file mb-3" id="postImgDiv">
          <input type="file" class="custom-file-input file-upload" accept="image/*" id="postImg" name="postPic" required>
          <label class="custom-file-label" id="intext-label" for="postImg">Image Upload</label>
        </div>
        <div class="form-group">
          <label for="postImgPreview">Image Preview</label>
          <div class='imgPreviewContainer'>
            <img id='postImgPreview'>
          </div>
        </div>
        <div class="form-group">
          <label for="postBodyInput">Caption</label>
          <textarea class="form-control" id="postBodyInput" rows="10" name='body' required></textarea>
        </div>
        <input type="submit" class='btn btn-primary mb-5' value="Submit">
    </form>
</div>


<script>
  document.getElementById("postImg").addEventListener('change', function(event){
    document.getElementById("postImgPreview").setAttribute("src", URL.createObjectURL(event.target.files[0]));
    const index = this.value.lastIndexOf("\\")
    if(index > -1){
      document.getElementById("intext-label").textContent = this.value.substring(this.value.lastIndexOf("\\"));
    }else{
      document.getElementById("intext-label").textContent = this.value;
    }
  });
</script>

<%- include('../partials/footer') %>